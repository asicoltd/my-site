<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Performance Tracker</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root {
    --bg-dark: #0f172a;
    --bg-light: #f8fafc;
    --text-dark: #e5e7eb;
    --text-light: #111827;
}

body {
    margin:0;
    font-family: system-ui,sans-serif;
    background: var(--bg-dark);
    color: var(--text-dark);
    padding:12px;
    transition: background 0.3s, color 0.3s;
}
h1 { text-align:center; margin-bottom:12px; color:#6ee7b7; font-size:1.8rem; }

/* Controls */
.controls {
    display:flex; flex-wrap:wrap; justify-content:center; gap:8px; margin-bottom:12px;
}
.controls input, .controls select, .controls button {
    padding:6px 10px; border-radius:6px; border:none; font-size:14px;
}
.controls input, .controls select { background:#1e293b; color:var(--text-dark); }
.controls button { background:#2563eb; color:white; cursor:pointer; }
.controls button#modeToggle { background:#6b7280; }

/* Grid container */
#weekView { overflow:auto; margin-bottom:12px; }
.week-grid {
    display:grid;
    gap:4px;
}

/* Header and cell styles */
.hour-label, .day-label {
    text-align:center; font-size:12px; padding:6px 2px; border-radius:4px;
    transition: background 0.3s, color 0.3s;
}
.hour-label { background:#020617; color:#93c5fd; }
.day-label { background:transparent; color:#e5e7eb; }

/* Cells */
.hour-cell { width:32px; height:32px; border:1px solid #334155; cursor:pointer; transition: background 0.3s; }
.black { background:#111827; }
.sleep { background:#1e40af; }
.wasted { background:#4b5563; }
.full { background:#059669; }
.semi { background:#f59e0b; }
.clg { background:#7c3aed; }

/* Legend */
.legend { display:flex; flex-wrap:wrap; justify-content:center; gap:12px; margin-top:12px; }
.legend-item { display:flex; align-items:center; gap:6px; font-size:12px; }
.color-box { width:18px; height:18px; border-radius:3px; transition: background 0.3s; }

/* Capture hidden */
#capture { position:fixed; left:-9999px; top:0; padding:16px; background: var(--bg-dark); border-radius:12px; }

@media(max-width:768px){
    .hour-cell{width:28px;height:28px;}
}
</style>
</head>
<body>

<h1></h1>

<div class="controls">
    <input type="date" id="startDate">
    <select id="modeSelect">
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
    </select>
    <button onclick="generate()">Apply</button>
    <button onclick="downloadGrid()">Download</button>
    <button id="modeToggle">Toggle Light/Dark</button>
</div>

<div id="weekView">
    <div class="week-grid" id="weekGrid"></div>
</div>

<div class="legend">
    <div class="legend-item"><div class="color-box sleep"></div>Sleep</div>
    <div class="legend-item"><div class="color-box wasted"></div>Wasted</div>
    <div class="legend-item"><div class="color-box full"></div>Full Focused</div>
    <div class="legend-item"><div class="color-box semi"></div>Semi Focused</div>
    <div class="legend-item"><div class="color-box clg"></div>CLG</div>
    <div class="legend-item"><div class="color-box black"></div>Idle</div>
</div>

<div id="capture">
    <div class="week-grid" id="captureGrid"></div>
</div>

<script>
const states = ["black","sleep","wasted","full","semi","clg"];
const weekGrid = document.getElementById("weekGrid");
const captureGrid = document.getElementById("captureGrid");
const startInput = document.getElementById("startDate");
const modeSelect = document.getElementById("modeSelect");
const modeToggle = document.getElementById("modeToggle");

startInput.valueAsDate = new Date();
let darkMode = true;

// Toggle dark/light mode
modeToggle.onclick = ()=>{
    darkMode = !darkMode;
    document.body.style.background = darkMode ? 'var(--bg-dark)' : 'var(--bg-light)';
    document.body.style.color = darkMode ? 'var(--text-dark)' : 'var(--text-light)';
    document.getElementById('capture').style.background = darkMode ? 'var(--bg-dark)' : 'var(--bg-light)';
    document.querySelectorAll('.hour-label').forEach(e=>e.style.background= darkMode ? '#020617' : '#e5e7eb');
};

// Format date as dd/mm/yy
function formatDate(date){
    const d=String(date.getDate()).padStart(2,'0');
    const m=String(date.getMonth()+1).padStart(2,'0');
    const y=String(date.getFullYear()).slice(-2);
    return `${d}/${m}/${y}`;
}

// Format hour to 12-hour format
function formatHour(h){
    const ampm = h<12 ? "AM" : "PM";
    let hour = h%12; if(hour===0) hour=12;
    return `${hour}${ampm}`;
}

function loadHistory(key){
    const data = localStorage.getItem(key);
    return data ? JSON.parse(data) : {};
}
function saveHistory(key,data){
    localStorage.setItem(key,JSON.stringify(data));
}

// Generate tracker grid
function generate(){
    weekGrid.innerHTML = ""; captureGrid.innerHTML="";
    const mode = modeSelect.value;
    const start = new Date(startInput.value);
    const days = mode==="weekly"?7:28;
    const historyKey = mode==="weekly"?"weekHistory":"monthHistory";
    const history = loadHistory(historyKey);

    // Set columns = 24 hours + 1 for day label
    weekGrid.style.gridTemplateColumns=`repeat(${25}, auto)`;
    captureGrid.style.gridTemplateColumns=`repeat(${25}, auto)`;

    // Header row: empty first cell + 24 hours
    weekGrid.appendChild(document.createElement("div")); // top-left empty
    captureGrid.appendChild(document.createElement("div"));

    for(let h=0; h<24; h++){
        const header = document.createElement("div"); header.className="hour-label"; header.textContent=formatHour(h);
        const headerC = header.cloneNode(true);
        weekGrid.appendChild(header); captureGrid.appendChild(headerC);
    }

    // Rows: one per day
    for(let d=0; d<days; d++){
        const day = new Date(start); day.setDate(start.getDate()+d);
        const dayLabel = document.createElement("div"); dayLabel.className="day-label"; dayLabel.textContent=formatDate(day);
        const dayLabelC = dayLabel.cloneNode(true);
        weekGrid.appendChild(dayLabel); captureGrid.appendChild(dayLabelC);

        for(let h=0; h<24; h++){
            const fdate = formatDate(day);
            const cell = document.createElement("div"); cell.className="hour-cell black"; cell.dataset.state=0;
            const cellC = cell.cloneNode(true);

            if(history[fdate] && history[fdate][h]!=undefined){
                cell.dataset.state=history[fdate][h]; cell.className="hour-cell "+states[history[fdate][h]];
            }

            cell.onclick = ()=>{
                let s=Number(cell.dataset.state); cell.classList.remove(states[s]);
                s=(s+1)%states.length; cell.dataset.state=s; cell.classList.add(states[s]);
                history[fdate]=history[fdate]||[]; history[fdate][h]=s; saveHistory(historyKey,history);
            };

            weekGrid.appendChild(cell); captureGrid.appendChild(cellC);
        }
    }
}

// Download as image
function downloadGrid(){
    html2canvas(document.getElementById("capture"),{scale:2,backgroundColor:darkMode ? "#0f172a" : "#f8fafc"}).then(canvas=>{
        const link=document.createElement("a"); link.download="grid.png";
        link.href=canvas.toDataURL(); link.click();
    });
}

// Reminder notifications
if("Notification" in window){
    Notification.requestPermission();
    setInterval(()=>{
        if(Notification.permission==="granted"){
            new Notification("Update ","Click hour blocks to update your status!");
        }
    },3600*1000);
}

generate();
</script>
</body>
</html>
