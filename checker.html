<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weekly Time Grid (Transposed)</title>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: system-ui, -apple-system, Segoe UI, sans-serif;
}

body {
    background: #0f172a;
    color: #e5e7eb;
    padding: 16px;
}

/* HEADER */
.header {
    text-align: center;
    margin-bottom: 14px;
}

.header h1 {
    color: #6ee7b7;
    font-size: 1.6rem;
}

.date-input {
    margin-top: 6px;
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background: #1f2937;
    color: #6ee7b7;
}

/* GRID */
.grid-wrapper {
    overflow-x: auto;
    background: #020617;
    padding: 12px;
    border-radius: 12px;
}

.week-grid {
    display: grid;
    grid-template-columns: 70px repeat(7, minmax(40px, 1fr));
    gap: 6px;
    min-width: 500px;
}

/* LABELS */
.corner {
    font-size: 0.8rem;
    color: #94a3b8;
}

.day-label {
    text-align: center;
    font-size: 0.8rem;
    color: #93c5fd;
}

.hour-label {
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    color: #cbd5f5;
}

/* CELLS */
.hour-cell {
    aspect-ratio: 1;
    border-radius: 4px;
    cursor: pointer;
}

.black { background: #1f2937; }
.green { background: #10b981; }
.yellow { background: #f59e0b; }
.red { background: #ef4444; }

/* CONTROLS */
.controls {
    margin-top: 14px;
    display: flex;
    gap: 10px;
}

button {
    flex: 1;
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    color: white;
}

.download { background: #10b981; }
.reset { background: #3b82f6; }

/* DOWNLOAD ONLY */
#capture {
    position: fixed;
    left: -9999px;
    top: 0;
    background: #020617;
    padding: 16px;
    border-radius: 12px;
}
</style>
</head>

<body>

<div class="header">
    <h1>Weekly Time Grid</h1>
    <input type="date" id="startDate" class="date-input">
</div>

<div class="grid-wrapper">
    <div class="week-grid" id="weekGrid"></div>
</div>

<div class="controls">
    <button class="download" id="downloadBtn">Download Week</button>
    <button class="reset" id="resetBtn">Reset</button>
</div>

<!-- Hidden capture -->
<div id="capture">
    <div class="week-grid" id="captureGrid"></div>
</div>

<script>
const states = ['black','green','yellow','red'];
const weekGrid = document.getElementById('weekGrid');
const captureGrid = document.getElementById('captureGrid');
const startDateInput = document.getElementById('startDate');

startDateInput.valueAsDate = new Date();

function formatDay(date) {
    return date.toLocaleDateString('en-US', {
        weekday: 'short',
        day: 'numeric'
    });
}

function hourLabel(h) {
    if (h === 0) return '12 AM';
    if (h < 12) return h + ' AM';
    if (h === 12) return '12 PM';
    return (h - 12) + ' PM';
}

function buildWeek(target) {
    target.innerHTML = '';
    const start = new Date(startDateInput.value);

    /* Top-left corner */
    const corner = document.createElement('div');
    corner.className = 'corner';
    corner.textContent = 'Hour';
    target.appendChild(corner);

    /* Day headers */
    for (let d = 0; d < 7; d++) {
        const day = new Date(start);
        day.setDate(start.getDate() + d);

        const label = document.createElement('div');
        label.className = 'day-label';
        label.textContent = formatDay(day);
        target.appendChild(label);
    }

    /* Hour rows */
    for (let h = 0; h < 24; h++) {
        const hLabel = document.createElement('div');
        hLabel.className = 'hour-label';
        hLabel.textContent = hourLabel(h);
        target.appendChild(hLabel);

        for (let d = 0; d < 7; d++) {
            const cell = document.createElement('div');
            cell.className = 'hour-cell black';
            cell.dataset.state = 0;

            cell.onclick = () => {
                let s = (+cell.dataset.state + 1) % 4;
                cell.dataset.state = s;
                cell.className = 'hour-cell ' + states[s];
            };

            target.appendChild(cell);
        }
    }
}

function syncCapture() {
    captureGrid.innerHTML = weekGrid.innerHTML;
}

document.getElementById('resetBtn').onclick = () => {
    document.querySelectorAll('.hour-cell').forEach(c => {
        c.dataset.state = 0;
        c.className = 'hour-cell black';
    });
};

document.getElementById('downloadBtn').onclick = () => {
    syncCapture();
    html2canvas(document.getElementById('capture'), { scale: 2 })
    .then(canvas => {
        const link = document.createElement('a');
        link.download = `weekly-grid-${startDateInput.value}.png`;
        link.href = canvas.toDataURL();
        link.click();
    });
};

startDateInput.onchange = () => buildWeek(weekGrid);

buildWeek(weekGrid);
</script>

</body>
</html>